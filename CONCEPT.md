# Концепция integramDD

## Основная идея: Модель данных "Квинтет"

integramDD - это **универсальная low-code платформа** для управления данными, основанная на модели данных "Квинтет" (Quintet data model). Это инновационный подход к хранению данных, при котором вся информация представляется в виде индексированных и связанных значений в единой таблице.

## Модель данных "Квинтет"

### Структура таблицы

Вся информация хранится в единой таблице со следующими полями:

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | bigserial | Уникальный идентификатор записи |
| `up` | int8 | Родительский объект (parent) |
| `t` | int8 | Тип/термин (type/term) |
| `val` | text | Значение (value) |

**Примечание:** В PHP версии также присутствует поле `ord` (порядок/order) для сортировки.

### Ключевые принципы

1. **Самоописываемые данные**
   - Каждая запись содержит полную информацию о себе и своих связях
   - Метаданные хранятся в той же таблице, что и данные
   - Записи с `up=0` являются метаданными (типы, термины, модификаторы)

2. **Единая структура хранения**
   - Один формат для всех типов данных
   - Нет необходимости в миграциях при изменении структуры
   - Гибкость в создании любых структур данных

3. **Динамическое создание структур**
   - Пользователи могут создавать новые типы данных без программирования
   - Определение новых терминов и реквизитов через API
   - Мгновенное применение изменений без перезапуска

### Базовые типы данных

Система поддерживает следующие базовые типы:

| ID | Тип | Описание |
|----|-----|----------|
| 2 | HTML | HTML-разметка |
| 3 | CHARS | Короткий текст |
| 4 | DATETIME | Дата и время |
| 5 | TERM | Ссылка на другой термин |
| 6 | PWD | Пароль (зашифрованный) |
| 7 | BUTTON | Кнопка действия |
| 8 | MEDIA | Медиа-файл |
| 9 | DATE | Дата |
| 10 | FILE | Файл |
| 11 | BOOLEAN | Логический тип |
| 12 | MEMO | Большой текст |
| 13 | NUMBER | Целое число |
| 14 | FLOAT | Число с плавающей точкой |
| 15 | CALCULATABLE | Вычисляемое поле |
| 16 | UUID | Уникальный идентификатор |
| 17 | PATH | Путь к файлу |

### Модификаторы

Модификаторы позволяют настраивать поведение полей:

| ID | Модификатор | Описание |
|----|-------------|----------|
| 30 | NOT NULL | Обязательное поле |
| 31 | ALIAS | Псевдоним поля |
| 32 | MULTIPLE | Множественные значения (массивы) |
| 33 | ORDER | Порядок сортировки |
| 34 | UNIQUE | Уникальное значение |
| 35 | SIZE | Размер/ограничение поля |
| 36 | VALIDATION | Правила валидации |
| 37 | SHARD | Шардирование данных |

## Архитектура текущего приложения

### Backend (Python/FastAPI)

```
┌─────────────────────────────────────────────┐
│           FastAPI Application                │
├─────────────────────────────────────────────┤
│  API Endpoints:                              │
│  • /health     - проверка работоспособности │
│  • /terms      - работа с терминами         │
│  • /metadata   - метаданные терминов        │
│  • /objects    - CRUD операции с объектами  │
│  • /requisites - управление реквизитами     │
│  • /references - ссылки между терминами     │
├─────────────────────────────────────────────┤
│  Services:                                   │
│  • term_builder     - построение терминов   │
│  • filter_builder   - построение фильтров   │
│  • object_by_term   - получение объектов    │
│  • error_manager    - управление ошибками   │
├─────────────────────────────────────────────┤
│  PostgreSQL Functions (Stored Procedures):   │
│  • post_terms/objects   - создание записей  │
│  • patch_terms/objects  - обновление        │
│  • delete_terms/objects - удаление          │
│  • get_term_metadata    - получение метаданных│
└─────────────────────────────────────────────┘
```

### Database (PostgreSQL)

- **Основная таблица**: `rep` (название может быть динамическим)
- **Индексы**:
  - `(up, t)` - для быстрого поиска по родителю и типу
  - `(t, lower(left(val, 127)))` - для поиска по типу и значению
- **Stored Procedures**: Инкапсуляция бизнес-логики на уровне БД

### Аутентификация

- Bearer Token аутентификация
- Middleware для проверки токенов
- Базовая система безопасности (требует расширения)

## Преимущества модели Квинтет

1. **Гибкость**
   - Создание любых структур данных без изменения схемы БД
   - Динамическое добавление полей и типов

2. **Масштабируемость**
   - Единая таблица с оптимизированными индексами
   - Возможность обработки миллионов записей
   - Индексация по всем полям "из коробки"

3. **Простота разработки**
   - Единый API для всех типов данных
   - Не требуется ORM с множеством моделей
   - Меньше кода для поддержки

4. **Low-code возможности**
   - Пользователи создают структуры через UI
   - Нет необходимости в программистах для настройки
   - Быстрое прототипирование

## Отличия от традиционных подходов

### Традиционный подход (реляционные БД)
```sql
CREATE TABLE users (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100)
);

CREATE TABLE products (
    id INT PRIMARY KEY,
    title VARCHAR(200),
    price DECIMAL(10,2)
);
```

### Подход Квинтет
```sql
-- Всё в одной таблице
CREATE TABLE rep (
    id BIGSERIAL PRIMARY KEY,
    up INT8,
    t INT8,
    val TEXT
);

-- Метаданные (up=0)
INSERT INTO rep VALUES (64, 0, 3, 'Пользователь'); -- термин
INSERT INTO rep VALUES (65, 0, 3, 'Имя');          -- реквизит
INSERT INTO rep VALUES (66, 0, 3, 'email');        -- реквизит

-- Реквизиты термина (up=термин)
INSERT INTO rep VALUES (100, 64, 65, '1'); -- порядок реквизита "Имя"
INSERT INTO rep VALUES (101, 64, 66, '2'); -- порядок реквизита "email"

-- Данные (up=объект)
INSERT INTO rep VALUES (1000, 1, 64, 'user1'); -- объект типа "Пользователь"
INSERT INTO rep VALUES (1001, 1000, 65, 'Иван'); -- значение "Имя"
INSERT INTO rep VALUES (1002, 1000, 66, 'ivan@example.com'); -- значение "email"
```

## Примеры использования

### Создание нового термина (типа данных)
```json
POST /{db_name}/terms
{
  "val": "Товар",
  "t": 3,
  "ALIAS": "product"
}
```

### Добавление реквизита к термину
```json
POST /{db_name}/requisites
{
  "term_id": 64,
  "req_id": 65,
  "NOT NULL": true,
  "UNIQUE": true
}
```

### Создание объекта
```json
POST /{db_name}/objects
{
  "t": 64,
  "fields": {
    "65": "Иван Иванов",
    "66": "ivan@example.com"
  }
}
```

### Получение объектов определенного типа с фильтрацией
```json
POST /{db_name}/objects/by-term
{
  "term_id": 64,
  "filters": {
    "65": {
      "operator": "LIKE",
      "value": "Иван%"
    }
  },
  "limit": 10,
  "offset": 0
}
```

## Целевая аудитория

1. **Разработчики**
   - Быстрое создание backend для прототипов
   - Гибкая система без жестких схем БД

2. **Бизнес-аналитики**
   - Создание структур данных без программирования
   - Настройка отчетов и фильтров

3. **Администраторы данных**
   - Управление большими объемами информации
   - Гибкая настройка прав доступа

4. **Компании**
   - Корпоративные системы учета
   - CRM и ERP системы
   - Системы документооборота

## Сравнение с аналогами

| Характеристика | integramDD | Традиционные ORM | No-code платформы |
|----------------|------------|------------------|-------------------|
| Гибкость схемы | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐ |
| Производительность | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| Простота использования | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| Масштабируемость | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| Стоимость | Бесплатно | Бесплатно | $$$ |
| Настраиваемость | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |

## Технологический стек

### Backend
- **Язык**: Python 3.11+
- **Framework**: FastAPI (async/await)
- **База данных**: PostgreSQL 14+
- **ORM**: SQLAlchemy (Core, без моделей)
- **Валидация**: Pydantic v2

### Frontend (планируется)
- **Framework**: React или Vue.js
- **Язык**: TypeScript
- **State Management**: Zustand/Redux
- **UI Library**: Ant Design / Material UI
- **Build Tool**: Vite

### DevOps
- **Контейнеризация**: Docker, Docker Compose
- **CI/CD**: GitHub Actions
- **Тестирование**: pytest (backend), Jest (frontend)
- **Мониторинг**: Prometheus + Grafana (планируется)

## Ссылки

- **Исходный PHP проект**: [ideav/Ideav](https://github.com/ideav/Ideav)
- **Текущий репозиторий**: [unidel2035/integramDD](https://github.com/unidel2035/integramDD)
- **Документация API**: http://localhost:8000/docs (после запуска)

## Дальнейшее развитие

Подробный план развития описан в [DEVELOPMENT_PLAN.md](./DEVELOPMENT_PLAN.md).
